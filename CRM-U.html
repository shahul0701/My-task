<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Complete CRM System</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    /* Global Styles */
    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }
    
    :root {
        --primary: #264653;
        --secondary: #2a9d8f;
        --accent: #e76f51;
        --light: #f8f9fa;
        --dark: #343a40;
        --success: #28a745;
        --warning: #ffc107;
        --danger: #dc3545;
        --info: #17a2b8;
        --gray: #6c757d;
        --light-gray: #e9ecef;
    }
    
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f5f7f9;
        color: #333;
        line-height: 1.6;
    }
    
    /* Login Form */
    .login-container {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    }
    
    .login-form {
        background: white;
        border-radius: 10px;
        padding: 30px;
        width: 100%;
        max-width: 400px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    
    .login-form h2 {
        text-align: center;
        margin-bottom: 20px;
        color: var(--primary);
    }
    
    .login-form .form-group {
        margin-bottom: 20px;
    }
    
    .login-form .form-label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
    }
    
    .login-form .form-control {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid #ced4da;
        border-radius: 6px;
        font-size: 16px;
        transition: all 0.2s;
    }
    
    .login-form .form-control:focus {
        outline: none;
        border-color: var(--secondary);
        box-shadow: 0 0 0 3px rgba(42, 157, 143, 0.2);
    }
    
    .login-form .btn {
        width: 100%;
        padding: 12px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.3s;
    }
    
    .login-form .btn:hover {
        background: #1a3340;
    }
    
    /* Layout */
    .app-container {
        display: flex;
        min-height: 100vh;
    }
    
    /* Sidebar */
    .sidebar {
        width: 250px;
        background: var(--primary);
        color: white;
        padding: 20px 0;
        transition: all 0.3s ease;
        position: fixed;
        height: 100vh;
        overflow-y: auto;
        z-index: 1000;
    }
    
    .sidebar-header {
        padding: 0 20px 20px;
        border-bottom: 1px solid rgba(255,255,255,0.1);
        margin-bottom: 20px;
    }
    
    .sidebar-header h3 {
        color: white;
        font-size: 22px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .sidebar-header h3 i {
        color: var(--secondary);
    }
    
    .nav-section {
        margin-bottom: 25px;
    }
    
    .nav-section-title {
        padding: 0 20px;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: rgba(255,255,255,0.6);
        margin-bottom: 10px;
    }
    
    .nav-item {
        display: flex;
        align-items: center;
        padding: 12px 20px;
        color: rgba(255,255,255,0.8);
        text-decoration: none;
        transition: all 0.2s;
        border-left: 3px solid transparent;
    }
    
    .nav-item:hover, .nav-item.active {
        background: rgba(255,255,255,0.05);
        color: white;
        border-left-color: var(--secondary);
    }
    
    .nav-item i {
        margin-right: 12px;
        width: 20px;
        text-align: center;
    }
    
    /* Main Content */
    .main-content {
        flex: 1;
        margin-left: 250px;
        padding: 20px;
        transition: all 0.3s ease;
    }
    
    /* Top Bar */
    .top-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 25px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        margin-bottom: 25px;
    }
    
    .search-box {
        display: flex;
        align-items: center;
        background: var(--light);
        border-radius: 50px;
        padding: 8px 15px;
        width: 300px;
    }
    
    .search-box input {
        border: none;
        background: transparent;
        padding: 5px 10px;
        width: 100%;
        outline: none;
    }
    
    .search-box i {
        color: var(--gray);
    }
    
    .user-menu {
        display: flex;
        align-items: center;
        gap: 15px;
    }
    
    .notifications {
        position: relative;
        cursor: pointer;
    }
    
    .notification-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background: var(--danger);
        color: white;
        font-size: 10px;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .user-profile {
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
    }
    
    .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: var(--secondary);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 18px;
    }
    
    /* Dashboard */
    .dashboard {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 25px;
    }
    
    .stat-card {
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        display: flex;
        flex-direction: column;
    }
    
    .stat-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }
    
    .stat-card-title {
        color: var(--gray);
        font-size: 14px;
    }
    
    .stat-card-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
    }
    
    .stat-card-value {
        font-size: 28px;
        font-weight: bold;
        margin-bottom: 5px;
    }
    
    .stat-card-change {
        font-size: 12px;
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .change-positive {
        color: var(--success);
    }
    
    .change-negative {
        color: var(--danger);
    }
    
    /* Charts */
    .charts-container {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 20px;
        margin-bottom: 25px;
    }
    
    .chart-card {
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    
    .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
    
    .chart-title {
        font-size: 18px;
        font-weight: 600;
    }
    
    .chart-actions {
        display: flex;
        gap: 10px;
    }
    
    /* Recent Activity */
    .activity-list {
        list-style: none;
    }
    
    .activity-item {
        display: flex;
        padding: 15px 0;
        border-bottom: 1px solid var(--light-gray);
    }
    
    .activity-item:last-child {
        border-bottom: none;
    }
    
    .activity-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 15px;
        flex-shrink: 0;
    }
    
    .activity-content {
        flex: 1;
    }
    
    .activity-title {
        font-weight: 500;
        margin-bottom: 5px;
    }
    
    .activity-desc {
        color: var(--gray);
        font-size: 14px;
    }
    
    .activity-time {
        color: var(--gray);
        font-size: 12px;
        margin-top: 5px;
    }
    
    /* Tables */
    .table-container {
        background: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        margin-bottom: 25px;
    }
    
    .table-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid var(--light-gray);
    }
    
    .table-title {
        font-size: 18px;
        font-weight: 600;
    }
    
    table {
        width: 100%;
        border-collapse: collapse;
    }
    
    th, td {
        padding: 15px 20px;
        text-align: left;
        border-bottom: 1px solid var(--light-gray);
    }
    
    th {
        background: var(--light);
        font-weight: 600;
        color: var(--dark);
    }
    
    tr:last-child td {
        border-bottom: none;
    }
    
    tr:hover {
        background: #f8f9fa;
    }
    
    /* Buttons */
    .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.2s;
        text-decoration: none;
    }
    
    .btn-sm {
        padding: 6px 12px;
        font-size: 14px;
    }
    
    .btn-primary {
        background: var(--primary);
        color: white;
    }
    
    .btn-primary:hover {
        background: #1a3340;
    }
    
    .btn-secondary {
        background: var(--secondary);
        color: white;
    }
    
    .btn-secondary:hover {
        background: #23857a;
    }
    
    .btn-accent {
        background: var(--accent);
        color: white;
    }
    
    .btn-accent:hover {
        background: #d45a3e;
    }
    
    .btn-light {
        background: var(--light);
        color: var(--dark);
    }
    
    .btn-light:hover {
        background: #e9ecef;
    }
    
    /* Badges */
    .badge {
        display: inline-block;
        padding: 5px 10px;
        border-radius: 50px;
        font-size: 12px;
        font-weight: 500;
    }
    
    .badge-primary {
        background: rgba(38, 70, 83, 0.1);
        color: var(--primary);
    }
    
    .badge-secondary {
        background: rgba(42, 157, 143, 0.1);
        color: var(--secondary);
    }
    
    .badge-accent {
        background: rgba(231, 111, 81, 0.1);
        color: var(--accent);
    }
    
    .badge-success {
        background: rgba(40, 167, 69, 0.1);
        color: var(--success);
    }
    
    .badge-warning {
        background: rgba(255, 193, 7, 0.1);
        color: var(--warning);
    }
    
    .badge-danger {
        background: rgba(220, 53, 69, 0.1);
        color: var(--danger);
    }
    
    /* Forms */
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
    }
    
    .form-control {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid #ced4da;
        border-radius: 6px;
        font-size: 16px;
        transition: all 0.2s;
    }
    
    .form-control:focus {
        outline: none;
        border-color: var(--secondary);
        box-shadow: 0 0 0 3px rgba(42, 157, 143, 0.2);
    }
    
    /* Modal */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 2000;
        justify-content: center;
        align-items: center;
    }
    
    .modal-content {
        background: white;
        border-radius: 10px;
        width: 90%;
        max-width: 600px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    
    .modal-header {
        padding: 20px;
        border-bottom: 1px solid var(--light-gray);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .modal-title {
        font-size: 20px;
        font-weight: 600;
    }
    
    .modal-close {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: var(--gray);
    }
    
    .modal-body {
        padding: 20px;
    }
    
    .modal-footer {
        padding: 20px;
        border-top: 1px solid var(--light-gray);
        display: flex;
        justify-content: flex-end;
        gap: 10px;
    }
    
    /* Responsive */
    @media (max-width: 992px) {
        .sidebar {
            width: 70px;
            overflow: visible;
        }
        
        .sidebar .nav-text {
            display: none;
        }
        
        .main-content {
            margin-left: 70px;
        }
        
        .charts-container {
            grid-template-columns: 1fr;
        }
    }
    
    @media (max-width: 768px) {
        .dashboard {
            grid-template-columns: 1fr;
        }
        
        .top-bar {
            flex-direction: column;
            gap: 15px;
            align-items: flex-start;
        }
        
        .search-box {
            width: 100%;
        }
    }
    
    /* Page specific styles */
    .page {
        display: none;
    }
    
    .page.active {
        display: block;
    }
    
    /* Kanban Board */
    .kanban-board {
        display: flex;
        gap: 20px;
        overflow-x: auto;
        padding: 10px 0;
    }
    
    .kanban-column {
        background: var(--light);
        border-radius: 8px;
        min-width: 300px;
        max-height: 70vh;
        overflow-y: auto;
    }
    
    .kanban-header {
        padding: 15px;
        font-weight: 600;
        border-bottom: 1px solid var(--light-gray);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .kanban-count {
        background: white;
        padding: 3px 8px;
        border-radius: 20px;
        font-size: 12px;
    }
    
    .kanban-items {
        padding: 15px;
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    
    .kanban-item {
        background: white;
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        cursor: pointer;
    }
    
    .kanban-item-title {
        font-weight: 500;
        margin-bottom: 8px;
    }
    
    .kanban-item-desc {
        font-size: 14px;
        color: var(--gray);
        margin-bottom: 10px;
    }
    
    .kanban-item-meta {
        display: flex;
        justify-content: space-between;
        font-size: 12px;
        color: var(--gray);
    }

    /* Loading overlay */
    #loadingOverlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.7);
        z-index: 10000;
        justify-content: center;
        align-items: center;
        color: white;
        font-size: 24px;
    }

    .spinner {
        border: 8px solid #f3f3f3;
        border-top: 8px solid #2a9d8f;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        animation: spin 1s linear infinite;
        margin: 0 auto;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Toast notification */
    #toast {
        visibility: hidden;
        min-width: 300px;
        background-color: #e76f51;
        color: white;
        text-align: center;
        border-radius: 8px;
        padding: 16px;
        position: fixed;
        z-index: 1000;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        font-weight: 600;
    }

    #toast.show {
        visibility: visible;
        animation: fadein 0.5s, fadeout 0.5s 2.5s;
    }

    @keyframes fadein {
        from {bottom: 0; opacity: 0;}
        to {bottom: 30px; opacity: 1;}
    }

    @keyframes fadeout {
        from {bottom: 30px; opacity: 1;}
        to {bottom: 0; opacity: 0;}
    }

    /* Company card styles */
    .company-card {
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        margin-bottom: 20px;
    }

    .company-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--light-gray);
    }

    .company-name {
        font-size: 20px;
        font-weight: 600;
        color: var(--primary);
    }

    .task-count {
        background: var(--secondary);
        color: white;
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 14px;
    }

    .work-list {
        list-style: none;
    }

    .work-item {
        padding: 12px 15px;
        border-bottom: 1px solid var(--light-gray);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .work-item:last-child {
        border-bottom: none;
    }

    .work-type {
        font-weight: 500;
    }

    .work-status {
        font-size: 12px;
        padding: 4px 8px;
        border-radius: 20px;
    }

    /* Lead assignment styles */
    .assignee-card {
        background: white;
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        margin-bottom: 15px;
    }

    .assignee-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 10px;
    }

    .assignee-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: var(--secondary);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
    }

    .assignee-name {
        font-weight: 600;
    }

    .task-list {
        list-style: none;
    }

    .task-item {
        padding: 8px 10px;
        border-bottom: 1px solid var(--light-gray);
        font-size: 14px;
    }

    .task-item:last-child {
        border-bottom: none;
    }

    /* Deal card styles */
    .deal-card {
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        margin-bottom: 20px;
    }

    .deal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }

    .deal-title {
        font-size: 18px;
        font-weight: 600;
    }

    .deal-value {
        background: var(--accent);
        color: white;
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 14px;
    }

    .deal-details {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
    }

    .deal-info {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .deal-info-label {
        font-size: 12px;
        color: var(--gray);
    }

    .deal-info-value {
        font-weight: 500;
    }
</style>
</head>
<body>
    <!-- Toast notification -->
    <div id="toast"></div>

    <!-- Loading overlay -->
    <div id="loadingOverlay">
        <div style="text-align: center;">
            <div style="margin-bottom: 20px;">Processing, please wait...</div>
            <div class="spinner"></div>
        </div>
    </div>

    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-form">
            <h2>CRM Login</h2>
            <div class="form-group">
                <label class="form-label">Username</label>
                <input type="text" class="form-control" id="loginUsername" placeholder="Enter your username">
            </div>
            <div class="form-group">
                <label class="form-label">Password</label>
                <input type="password" class="form-control" id="loginPassword" placeholder="Enter your password">
            </div>
            <button class="btn" id="loginBtn">Login</button>
        </div>
    </div>

    <!-- App Container (initially hidden) -->
    <div class="app-container" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h3><i class="fas fa-brain"></i> <span class="nav-text">SalesForce Pro</span></h3>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Main</div>
                <a href="#" class="nav-item active" data-page="dashboard">
                    <i class="fas fa-home"></i>
                    <span class="nav-text">Dashboard</span>
                </a>
                <a href="#" class="nav-item" data-page="tasks">
                    <i class="fas fa-tasks"></i>
                    <span class="nav-text">Tasks</span>
                </a>
                <a href="#" class="nav-item" data-page="leads">
                    <i class="fas fa-user-friends"></i>
                    <span class="nav-text">Leads</span>
                </a>
                <a href="#" class="nav-item" data-page="contacts">
                    <i class="fas fa-address-book"></i>
                    <span class="nav-text">Contacts</span>
                </a>
                <a href="#" class="nav-item" data-page="accounts">
                    <i class="fas fa-building"></i>
                    <span class="nav-text">Accounts</span>
                </a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Sales</div>
                <a href="#" class="nav-item" data-page="deals">
                    <i class="fas fa-handshake"></i>
                    <span class="nav-text">Deals</span>
                </a>
                <a href="#" class="nav-item" data-page="opportunities">
                    <i class="fas fa-chart-line"></i>
                    <span class="nav-text">Opportunities</span>
                </a>
                <a href="#" class="nav-item" data-page="forecasts">
                    <i class="fas fa-chart-bar"></i>
                    <span class="nav-text">Forecasts</span>
                </a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Support</div>
                <a href="#" class="nav-item" data-page="cases">
                    <i class="fas fa-life-ring"></i>
                    <span class="nav-text">Cases</span>
                </a>
                <a href="#" class="nav-item" data-page="tickets">
                    <i class="fas fa-ticket-alt"></i>
                    <span class="nav-text">Tickets</span>
                </a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Tools</div>
                <a href="#" class="nav-item" data-page="analytics">
                    <i class="fas fa-chart-pie"></i>
                    <span class="nav-text">Analytics</span>
                </a>
                <a href="#" class="nav-item" data-page="reports">
                    <i class="fas fa-file-alt"></i>
                    <span class="nav-text">Reports</span>
                </a>
                <a href="#" class="nav-item" data-page="settings">
                    <i class="fas fa-cog"></i>
                    <span class="nav-text">Settings</span>
                </a>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="globalSearch" placeholder="Search across CRM...">
                </div>
                
                <div class="user-menu">
                    <div class="notifications">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge">3</span>
                    </div>
                    
                    <div class="user-profile">
                        <div class="user-avatar" id="userAvatar">U</div>
                        <div class="user-info">
                            <div class="user-name" id="welcomeMsg">User Name</div>
                            <div class="user-role" style="font-size: 12px; color: var(--gray);">Administrator</div>
                        </div>
                        <button id="logoutBtn" style="background: none; border: none; margin-left: 10px; cursor: pointer;" title="Logout">
                            <i class="fas fa-sign-out-alt" style="color: var(--danger);"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Dashboard Page -->
            <div class="page active" id="dashboard">
                <div class="dashboard">
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-title">Total Tasks</div>
                            <div class="stat-card-icon" style="background: var(--secondary);">
                                <i class="fas fa-tasks"></i>
                            </div>
                        </div>
                        <div class="stat-card-value" id="totalTasks">0</div>
                        <div class="stat-card-change change-positive">
                            <i class="fas fa-arrow-up"></i> <span id="taskChange">0%</span> from last month
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-title">Completed Tasks</div>
                            <div class="stat-card-icon" style="background: var(--accent);">
                                <i class="fas fa-check-circle"></i>
                            </div>
                        </div>
                        <div class="stat-card-value" id="completedTasks">0</div>
                        <div class="stat-card-change change-positive">
                            <i class="fas fa-arrow-up"></i> <span id="completedChange">0%</span> from last month
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-title">In Progress</div>
                            <div class="stat-card-icon" style="background: var(--primary);">
                                <i class="fas fa-spinner"></i>
                            </div>
                        </div>
                        <div class="stat-card-value" id="inProgressTasks">0</div>
                        <div class="stat-card-change change-negative">
                            <i class="fas fa-arrow-down"></i> <span id="progressChange">0%</span> from last month
                        </div>
                    </div>
                </div>
                
                <div class="charts-container">
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title">Tasks Overview</div>
                            <div class="chart-actions">
                                <button class="btn btn-sm btn-light" id="btnThisMonth">This Month</button>
                                <button class="btn btn-sm btn-light" id="btnLastMonth">Last Month</button>
                            </div>
                        </div>
                        <div id="tasksChart" style="height: 300px;">
                            <!-- Chart will be rendered here -->
                            <canvas id="tasksOverviewChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title">Tasks by Status</div>
                        </div>
                        <div id="tasksStatusChart" style="height: 300px;">
                            <!-- Chart will be rendered here -->
                            <canvas id="tasksByStatusChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">Recent Tasks</div>
                        <button class="btn btn-primary" id="viewAllTasks">View All</button>
                    </div>
                    
                    <table id="recentTasksTable">
                        <thead>
                            <tr>
                                <th>SINO</th>
                                <th>Company</th>
                                <th>Type of Work</th>
                                <th>Status</th>
                                <th>Due Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Tasks Page -->
            <div class="page" id="tasks">
                <div class="table-header" style="margin-bottom: 20px;">
                    <div class="table-title">Task Management</div>
                    <button class="btn btn-primary" id="createTaskBtn"><i class="fas fa-plus"></i> Create Task</button>
                </div>

                <div style="margin-bottom: 15px;">
                    <input type="text" id="taskSearchInput" placeholder="Search tasks..." class="form-control" style="width: 300px;">
                </div>
                
                <div class="table-container">
                    <table id="tasksTable">
                        <thead>
                            <tr>
                                <th>SINO</th>
                                <th>Company</th>
                                <th>Type of Work</th>
                                <th>Status</th>
                                <th>Owner</th>
                                <th>Due Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>

                <div id="paginationControls" style="margin-top: 20px; text-align: center;"></div>
            </div>
            
            <!-- Leads Page -->
            <div class="page" id="leads">
                <div class="table-header" style="margin-bottom: 20px;">
                    <div class="table-title">Lead Management</div>
                    <button class="btn btn-primary" id="addLeadBtn"><i class="fas fa-plus"></i> Add Lead</button>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">Task Assignments</div>
                    </div>
                    
                    <div id="assigneeList">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- Accounts Page -->
            <div class="page" id="accounts">
                <div class="table-header" style="margin-bottom: 20px;">
                    <div class="table-title">Account Management</div>
                    <button class="btn btn-primary" id="addAccountBtn"><i class="fas fa-plus"></i> Add Account</button>
                </div>
                
                <div id="companyList">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Deals Page -->
            <div class="page" id="deals">
                <div class="table-header" style="margin-bottom: 20px;">
                    <div class="table-title">Deal Pipeline</div>
                    <button class="btn btn-primary" id="addDealBtn"><i class="fas fa-plus"></i> Add Deal</button>
                </div>
                
                <div id="dealsList">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Other pages would go here (Contacts, Opportunities, etc.) -->
            <div class="page" id="contacts">
                <div class="table-header" style="margin-bottom: 20px;">
                    <div class="table-title">Contact Management</div>
                    <button class="btn btn-primary" id="addContactBtn"><i class="fas fa-plus"></i> Add Contact</button>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Company</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>John Smith</td>
                                <td>Nexus Industries</td>
                                <td>john@nexus.com</td>
                                <td>(555) 123-4567</td>
                                <td><span class="badge badge-primary">Active</span></td>
                                <td>
                                    <button class="btn btn-sm btn-light"><i class="fas fa-edit"></i></button>
                                    <button class="btn btn-sm btn-light"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="page" id="opportunities">
                <div class="table-header" style="margin-bottom: 20px;">
                    <div class="table-title">Opportunity Management</div>
                    <button class="btn btn-primary"><i class="fas fa-plus"></i> Add Opportunity</button>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Company</th>
                                <th>Value</th>
                                <th>Stage</th>
                                <th>Close Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Enterprise Plan</td>
                                <td>ABC Corporation</td>
                                <td>$25,000</td>
                                <td><span class="badge badge-secondary">Proposal</span></td>
                                <td>Jun 30, 2023</td>
                                <td>
                                    <button class="btn btn-sm btn-light"><i class="fas fa-edit"></i></button>
                                    <button class="btn btn-sm btn-light"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="page" id="forecasts">
                <div class="table-header" style="margin-bottom: 20px;">
                    <div class="table-title">Sales Forecast</div>
                    <button class="btn btn-primary"><i class="fas fa-sync"></i> Refresh</button>
                </div>
                
                <div class="chart-card">
                    <div class="chart-header">
                        <div class="chart-title">Quarterly Forecast</div>
                    </div>
                    <div id="forecastChart" style="height: 300px;">
                        <!-- Chart will be rendered here -->
                        <canvas id="quarterlyForecastChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="page" id="cases">
                <div class="table-header" style="margin-bottom: 20px;">
                    <div class="table-title">Case Management</div>
                    <button class="btn btn-primary"><i class="fas fa-plus"></i> Add Case</button>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Case #</th>
                                <th>Subject</th>
                                <th>Company</th>
                                <th>Status</th>
                                <th>Priority</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>CS-001</td>
                                <td>Login Issue</td>
                                <td>XYZ Enterprises</td>
                                <td><span class="badge badge-secondary">In Progress</span></td>
                                <td><span class="badge badge-accent">High</span></td>
                                <td>
                                    <button class="btn btn-sm btn-light"><i class="fas fa-edit"></i></button>
                                    <button class="btn btn-sm btn-light"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="page" id="tickets">
                <div class="table-header" style="margin-bottom: 20px;">
                    <div class="table-title">Ticket Management</div>
                    <button class="btn btn-primary"><i class="fas fa-plus"></i> Add Ticket</button>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Ticket #</th>
                                <th>Subject</th>
                                <th>Requester</th>
                                <th>Status</th>
                                <th>Priority</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>TK-001</td>
                                <td>Password Reset</td>
                                <td>Sarah Johnson</td>
                                <td><span class="badge badge-success">Resolved</span></td>
                                <td><span class="badge badge-primary">Low</span></td>
                                <td>
                                    <button class="btn btn-sm btn-light"><i class="fas fa-edit"></i></button>
                                    <button class="btn btn-sm btn-light"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="page" id="analytics">
                <div class="table-header" style="margin-bottom: 20px;">
                    <div class="table-title">Analytics Dashboard</div>
                    <button class="btn btn-primary"><i class="fas fa-download"></i> Export Report</button>
                </div>
                
                <div class="charts-container">
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title">Performance Metrics</div>
                        </div>
                        <div id="performanceChart" style="height: 300px;">
                            <!-- Chart will be rendered here -->
                            <canvas id="performanceMetricsChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title">Conversion Rates</div>
                        </div>
                        <div id="conversionChart" style="height: 300px;">
                            <!-- Chart will be rendered here -->
                            <canvas id="conversionRatesChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="page" id="reports">
                <div class="table-header" style="margin-bottom: 20px;">
                    <div class="table-title">Report Library</div>
                    <button class="btn btn-primary"><i class="fas fa-plus"></i> Create Report</button>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Report Name</th>
                                <th>Type</th>
                                <th>Last Run</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Monthly Sales Performance</td>
                                <td>Sales</td>
                                <td>May 31, 2023</td>
                                <td>
                                    <button class="btn btn-sm btn-light"><i class="fas fa-play"></i> Run</button>
                                    <button class="btn btn-sm btn-light"><i class="fas fa-download"></i> Export</button>
                                </td>
                            </tr>
                            <tr>
                                <td>Customer Satisfaction</td>
                                <td>Service</td>
                                <td>May 15, 2023</td>
                                <td>
                                    <button class="btn btn-sm btn-light"><i class="fas fa-play"></i> Run</button>
                                    <button class="btn btn-sm btn-light"><i class="fas fa-download"></i> Export</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="page" id="settings">
                <div class="table-header" style="margin-bottom: 20px;">
                    <div class="table-title">System Settings</div>
                    <button class="btn btn-primary"><i class="fas fa-save"></i> Save Changes</button>
                </div>
                
                <div class="chart-card">
                    <div class="chart-header">
                        <div class="chart-title">User Preferences</div>
                    </div>
                    <div style="padding: 20px;">
                        <div class="form-group">
                            <label class="form-label">Theme</label>
                            <select class="form-control">
                                <option>Light</option>
                                <option>Dark</option>
                                <option>Auto</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Language</label>
                            <select class="form-control">
                                <option>English</option>
                                <option>Spanish</option>
                                <option>French</option>
                                <option>German</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Notifications</label>
                            <div>
                                <input type="checkbox" id="emailNotif" checked>
                                <label for="emailNotif">Email Notifications</label>
                            </div>
                            <div>
                                <input type="checkbox" id="browserNotif" checked>
                                <label for="browserNotif">Browser Notifications</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Task Modal -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Create Task</div>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="taskForm">
                    <div class="form-group">
                        <label class="form-label">SINO</label>
                        <input type="text" class="form-control" name="SINO" id="SINO" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Company Name</label>
                        <input list="companyList" class="form-control" name="Existing Company Name" id="companyName" required>
                        <datalist id="companyDatalist"></datalist>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">TYPE OF WORK</label>
                        <input list="workTypeList" class="form-control" name="TYPE OF WORK" id="typeOfWork" required>
                        <datalist id="workTypeDatalist"></datalist>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Account Type</label>
                        <select class="form-control" name="ACCOUNT TYPE" id="accountType">
                            <option value="">--Select--</option>
                            <option>Credit Card</option>
                            <option>Chequing Acc</option>
                            <option>Savings Acc</option>
                            <option>Loan Acc</option>
                            <option>Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Account # / Cards</label>
                        <input list="accountsCardsList" class="form-control" name="Accounts / Cards" id="accountsCards">
                        <datalist id="accountsCardsDatalist"></datalist>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Task</label>
                        <input type="text" class="form-control" name="Task" id="Task">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Owner</label>
                        <input type="text" class="form-control" name="Owner" id="Owner" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select class="form-control" name="Status" id="status">
                            <option value="Not Started" selected>Not Started</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Complete">Complete</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">WORK FOR</label>
                        <select class="form-control" name="WORK FOR" id="workFor">
                            <option value="">--Choose--</option>
                            <option value="Yearly">Yearly</option>
                            <option value="Monthly">Monthly</option>
                            <option value="Quarterly">Quarterly</option>
                            <option value="Bi-weekly">Bi-weekly</option>
                            <option value="Weekly">Weekly</option>
                            <option value="Custom">Custom</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Period/Year</label>
                        <input type="text" class="form-control" name="Period" id="period" placeholder="Enter period (e.g., 2023, Q1 2023, Jan-Mar 2023)">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Due Date</label>
                        <input type="date" class="form-control" name="Due date" id="dueDate" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Assigned By</label>
                        <input list="assignedByList" class="form-control" name="Assigned By" id="AssignedBy">
                        <datalist id="assignedByDatalist"></datalist>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Notes</label>
                        <textarea class="form-control" name="Notes" id="Notes" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-light" id="cancelBtn">Cancel</button>
                <button class="btn btn-primary" id="submitTaskBtn">Save Task</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyD9ymWqihHWbVb4IRop1lXT-huLjBvS50w",
            authDomain: "task-manager-602da.firebaseapp.com",
            projectId: "task-manager-602da",
            storageBucket: "task-manager-602da.appspot.com",
            messagingSenderId: "438978699329",
            appId: "1:438978699329:web:9f475d04352bbdaa5ce6c0"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        // Global variables
        let currentUser = null;
        let allTasks = [];
        
        // DOM elements
        const loginPage = document.getElementById('loginPage');
        const appContainer = document.querySelector('.app-container');
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const navItems = document.querySelectorAll('.nav-item');
        const pages = document.querySelectorAll('.page');
        const createTaskBtn = document.getElementById('createTaskBtn');
        const taskModal = document.getElementById('taskModal');
        const cancelBtn = document.getElementById('cancelBtn');
        const modalClose = document.querySelector('.modal-close');
        const submitTaskBtn = document.getElementById('submitTaskBtn');
        const taskForm = document.getElementById('taskForm');
        const toast = document.getElementById('toast');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const taskSearchInput = document.getElementById('taskSearchInput');
        const globalSearch = document.getElementById('globalSearch');
        const viewAllTasksBtn = document.getElementById('viewAllTasks');
        
        // Login functionality
        loginBtn.addEventListener('click', () => {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!username || !password) {
                showToast('Please enter both username and password');
                return;
            }
            
            // Simple authentication (in a real app, this would verify against a database)
            currentUser = username;
            sessionStorage.setItem('username', username);
            
            // Hide login page, show app
            loginPage.style.display = 'none';
            appContainer.style.display = 'flex';
            
            // Update UI with username
            document.getElementById('welcomeMsg').textContent = username;
            document.getElementById('userAvatar').textContent = username.charAt(0).toUpperCase();
            
            // Load initial data
            loadDashboardData();
            
            showToast(`Welcome back, ${username}!`);
        });
        
        // Logout functionality
        logoutBtn.addEventListener('click', () => {
            currentUser = null;
            sessionStorage.removeItem('username');
            
            // Hide app, show login page
            appContainer.style.display = 'none';
            loginPage.style.display = 'flex';
            
            // Clear login form
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
            
            showToast('You have been logged out');
        });
        
        // Check if user is already logged in
        function checkLoginStatus() {
            const savedUsername = sessionStorage.getItem('username');
            if (savedUsername) {
                currentUser = savedUsername;
                loginPage.style.display = 'none';
                appContainer.style.display = 'flex';
                document.getElementById('welcomeMsg').textContent = savedUsername;
                document.getElementById('userAvatar').textContent = savedUsername.charAt(0).toUpperCase();
                loadDashboardData();
            }
        }
        
        // Navigation
        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Remove active class from all items
                navItems.forEach(navItem => navItem.classList.remove('active'));
                
                // Add active class to clicked item
                this.classList.add('active');
                
                // Hide all pages
                pages.forEach(page => page.classList.remove('active'));
                
                // Show the selected page
                const pageId = this.getAttribute('data-page');
                document.getElementById(pageId).classList.add('active');
                
                // Load data for the selected page
                if (pageId === 'tasks') {
                    loadTasks();
                } else if (pageId === 'dashboard') {
                    loadDashboardData();
                } else if (pageId === 'leads') {
                    loadLeadsData();
                } else if (pageId === 'accounts') {
                    loadAccountsData();
                } else if (pageId === 'deals') {
                    loadDealsData();
                } else if (pageId === 'forecasts') {
                    loadForecastsData();
                } else if (pageId === 'analytics') {
                    loadAnalyticsData();
                }
            });
        });
        
        // Show/hide loading overlay
        function showLoading() {
            loadingOverlay.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function hideLoading() {
            loadingOverlay.style.display = 'none';
            document.body.style.overflow = '';
        }

        // Show toast notification
        function showToast(message) {
            toast.textContent = message;
            toast.className = 'show';
            setTimeout(() => { toast.className = toast.className.replace('show', ''); }, 3000);
        }
        
        // Modal controls
        createTaskBtn.addEventListener('click', async () => {
            if (!currentUser) {
                showToast('Please log in to create tasks');
                return;
            }
            
            // Generate SINO
            const newSINO = await generateSINO();
            document.getElementById('SINO').value = newSINO;
            
            // Set default values
            document.getElementById('Owner').value = currentUser;
            document.getElementById('Task').value = 'Daily Task';
            
            // Load dropdown options with current user's data
            await loadDropdownOptions();
            
            // Show modal
            taskModal.style.display = 'flex';
            document.querySelector('.modal-title').textContent = 'Create New Task';
        });
        
        cancelBtn.addEventListener('click', () => {
            taskModal.style.display = 'none';
            taskForm.reset();
        });
        
        modalClose.addEventListener('click', () => {
            taskModal.style.display = 'none';
            taskForm.reset();
        });
        
        // Close modal when clicking outside
        window.addEventListener('click', (e) => {
            if (e.target === taskModal) {
                taskModal.style.display = 'none';
                taskForm.reset();
            }
        });
        
        // View All Tasks button
        viewAllTasksBtn.addEventListener('click', () => {
            // Switch to tasks page
            navItems.forEach(navItem => navItem.classList.remove('active'));
            document.querySelector('[data-page="tasks"]').classList.add('active');
            
            pages.forEach(page => page.classList.remove('active'));
            document.getElementById('tasks').classList.add('active');
            
            // Load tasks
            loadTasks();
        });
        
        // Global search functionality
        globalSearch.addEventListener('keyup', (e) => {
            if (e.key === 'Enter') {
                const searchTerm = globalSearch.value.toLowerCase().trim();
                if (searchTerm) {
                    // Switch to tasks page and search
                    navItems.forEach(navItem => navItem.classList.remove('active'));
                    document.querySelector('[data-page="tasks"]').classList.add('active');
                    
                    pages.forEach(page => page.classList.remove('active'));
                    document.getElementById('tasks').classList.add('active');
                    
                    taskSearchInput.value = searchTerm;
                    filterTasks(searchTerm);
                }
            }
        });
        
        // Task search functionality
        taskSearchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase().trim();
            filterTasks(searchTerm);
        });
        
        // Filter tasks based on search term
        function filterTasks(searchTerm) {
            const rows = document.querySelectorAll('#tasksTable tbody tr');
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        // Load tasks from Firebase for the current user
        async function loadTasks() {
            if (!currentUser) return;
            
            try {
                showLoading();
                const snapshot = await db.collection('tasks')
                    .where('Owner', '==', currentUser)
                    .orderBy('SINO')
                    .get();
                
                allTasks = [];
                snapshot.forEach(doc => {
                    allTasks.push({id: doc.id, ...doc.data()});
                });
                
                const tasksTableBody = document.querySelector('#tasksTable tbody');
                tasksTableBody.innerHTML = '';
                
                if (allTasks.length === 0) {
                    tasksTableBody.innerHTML = '<tr><td colspan="7" style="text-align: center;">No tasks found</td></tr>';
                    return;
                }
                
                allTasks.forEach(task => {
                    const statusClass = task.Status === 'Complete' ? 'badge-success' : 
                                      task.Status === 'In Progress' ? 'badge-secondary' : 'badge-primary';
                    
                    const tr = document.createElement('tr');
                    
                    tr.innerHTML = `
                        <td>${task.SINO || ''}</td>
                        <td>${task['Existing Company Name'] || ''}</td>
                        <td>${task['TYPE OF WORK'] || ''}</td>
                        <td><span class="badge ${statusClass}">${task.Status || ''}</span></td>
                        <td>${task.Owner || ''}</td>
                        <td>${task['Due date'] || ''}</td>
                        <td>
                            <button class="btn btn-sm btn-light" data-id="${task.id}"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-sm btn-light" data-id="${task.id}"><i class="fas fa-trash"></i></button>
                        </td>
                    `;
                    
                    tasksTableBody.appendChild(tr);
                });
                
            } catch (error) {
                console.error('Error loading tasks:', error);
                showToast('Error loading tasks');
            } finally {
                hideLoading();
            }
        }
        
        // Load dashboard data for the current user
        async function loadDashboardData() {
            if (!currentUser) return;
            
            try {
                showLoading();
                const snapshot = await db.collection('tasks')
                    .where('Owner', '==', currentUser)
                    .get();
                
                const tasks = [];
                snapshot.forEach(doc => {
                    tasks.push({id: doc.id, ...doc.data()});
                });
                
                // Update stats
                document.getElementById('totalTasks').textContent = tasks.length;
                document.getElementById('completedTasks').textContent = tasks.filter(t => t.Status === 'Complete').length;
                document.getElementById('inProgressTasks').textContent = tasks.filter(t => t.Status === 'In Progress').length;
                
                // Update recent tasks table
                const recentTasksTable = document.querySelector('#recentTasksTable tbody');
                recentTasksTable.innerHTML = '';
                
                const recentTasks = tasks.slice(0, 5);
                recentTasks.forEach(task => {
                    const statusClass = task.Status === 'Complete' ? 'badge-success' : 
                                      task.Status === 'In Progress' ? 'badge-secondary' : 'badge-primary';
                    
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${task.SINO || ''}</td>
                        <td>${task['Existing Company Name'] || ''}</td>
                        <td>${task['TYPE OF WORK'] || ''}</td>
                        <td><span class="badge ${statusClass}">${task.Status || ''}</span></td>
                        <td>${task['Due date'] || ''}</td>
                    `;
                    recentTasksTable.appendChild(tr);
                });
                
                // Create charts
                createTasksChart(tasks);
                createTasksByStatusChart(tasks);
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                showToast('Error loading dashboard data');
            } finally {
                hideLoading();
            }
        }
        
        // Load leads data (task assignments)
        async function loadLeadsData() {
            try {
                showLoading();
                const snapshot = await db.collection('tasks').get();
                
                const tasks = [];
                snapshot.forEach(doc => {
                    tasks.push(doc.data());
                });
                
                // Group tasks by assignee
                const assigneeTasks = {};
                tasks.forEach(task => {
                    if (task.Owner) {
                        if (!assigneeTasks[task.Owner]) {
                            assigneeTasks[task.Owner] = [];
                        }
                        assigneeTasks[task.Owner].push(task);
                    }
                });
                
                // Display assignee cards
                const assigneeList = document.getElementById('assigneeList');
                assigneeList.innerHTML = '';
                
                for (const [assignee, tasks] of Object.entries(assigneeTasks)) {
                    const assigneeCard = document.createElement('div');
                    assigneeCard.className = 'assignee-card';
                    
                    assigneeCard.innerHTML = `
                        <div class="assignee-header">
                            <div class="assignee-avatar">${assignee.charAt(0).toUpperCase()}</div>
                            <div class="assignee-name">${assignee}</div>
                        </div>
                        <ul class="task-list">
                            ${tasks.map(task => `
                                <li class="task-item">
                                    <strong>${task['Existing Company Name'] || 'No Company'}</strong> - 
                                    ${task['TYPE OF WORK'] || 'No Work Type'} 
                                    <span class="badge ${task.Status === 'Complete' ? 'badge-success' : 
                                                       task.Status === 'In Progress' ? 'badge-secondary' : 'badge-primary'}">
                                        ${task.Status || 'No Status'}
                                    </span>
                                </li>
                            `).join('')}
                        </ul>
                    `;
                    
                    assigneeList.appendChild(assigneeCard);
                }
                
            } catch (error) {
                console.error('Error loading leads data:', error);
                showToast('Error loading leads data');
            } finally {
                hideLoading();
            }
        }
        
        // Load accounts data (companies and works)
        async function loadAccountsData() {
            if (!currentUser) return;
            
            try {
                showLoading();
                const snapshot = await db.collection('tasks')
                    .where('Owner', '==', currentUser)
                    .get();
                
                const tasks = [];
                snapshot.forEach(doc => {
                    tasks.push(doc.data());
                });
                
                // Group tasks by company
                const companyTasks = {};
                tasks.forEach(task => {
                    if (task['Existing Company Name']) {
                        if (!companyTasks[task['Existing Company Name']]) {
                            companyTasks[task['Existing Company Name']] = [];
                        }
                        companyTasks[task['Existing Company Name']].push(task);
                    }
                });
                
                // Display company cards
                const companyList = document.getElementById('companyList');
                companyList.innerHTML = '';
                
                for (const [company, tasks] of Object.entries(companyTasks)) {
                    const companyCard = document.createElement('div');
                    companyCard.className = 'company-card';
                    
                    companyCard.innerHTML = `
                        <div class="company-header">
                            <div class="company-name">${company}</div>
                            <div class="task-count">${tasks.length} tasks</div>
                        </div>
                        <ul class="work-list">
                            ${tasks.map(task => `
                                <li class="work-item">
                                    <div class="work-type">${task['TYPE OF WORK'] || 'No Work Type'}</div>
                                    <div class="work-status badge ${task.Status === 'Complete' ? 'badge-success' : 
                                                                   task.Status === 'In Progress' ? 'badge-secondary' : 'badge-primary'}">
                                        ${task.Status || 'No Status'}
                                    </div>
                                </li>
                            `).join('')}
                        </ul>
                    `;
                    
                    companyList.appendChild(companyCard);
                }
                
            } catch (error) {
                console.error('Error loading accounts data:', error);
                showToast('Error loading accounts data');
            } finally {
                hideLoading();
            }
        }
        
        // Load deals data
        async function loadDealsData() {
            try {
                showLoading();
                // Sample deals data - in a real app, this would come from Firebase
                const deals = [
                    {
                        title: 'Enterprise Plan',
                        company: 'ABC Corporation',
                        value: '$25,000',
                        stage: 'Proposal',
                        closeDate: '2023-06-30',
                        owner: 'You'
                    },
                    {
                        title: 'Premium Support',
                        company: 'TechSolutions Inc',
                        value: '$15,000',
                        stage: 'Negotiation',
                        closeDate: '2023-07-15',
                        owner: 'You'
                    },
                    {
                        title: 'Cloud Migration',
                        company: 'Global Enterprises',
                        value: '$42,000',
                        stage: 'Qualification',
                        closeDate: '2023-08-01',
                        owner: 'John Smith'
                    }
                ];
                
                // Display deals
                const dealsList = document.getElementById('dealsList');
                dealsList.innerHTML = '';
                
                deals.forEach(deal => {
                    const stageClass = deal.stage === 'Proposal' ? 'badge-secondary' : 
                                     deal.stage === 'Negotiation' ? 'badge-accent' : 'badge-primary';
                    
                    const dealCard = document.createElement('div');
                    dealCard.className = 'deal-card';
                    
                    dealCard.innerHTML = `
                        <div class="deal-header">
                            <div class="deal-title">${deal.title}</div>
                            <div class="deal-value">${deal.value}</div>
                        </div>
                        <div class="deal-details">
                            <div class="deal-info">
                                <span class="deal-info-label">Company</span>
                                <span class="deal-info-value">${deal.company}</span>
                            </div>
                            <div class="deal-info">
                                <span class="deal-info-label">Stage</span>
                                <span class="deal-info-value"><span class="badge ${stageClass}">${deal.stage}</span></span>
                            </div>
                            <div class="deal-info">
                                <span class="deal-info-label">Close Date</span>
                                <span class="deal-info-value">${deal.closeDate}</span>
                            </div>
                            <div class="deal-info">
                                <span class="deal-info-label">Owner</span>
                                <span class="deal-info-value">${deal.owner}</span>
                            </div>
                        </div>
                    `;
                    
                    dealsList.appendChild(dealCard);
                });
                
            } catch (error) {
                console.error('Error loading deals data:', error);
                showToast('Error loading deals data');
            } finally {
                hideLoading();
            }
        }
        
        // Load forecasts data
        async function loadForecastsData() {
            try {
                // Sample forecast data
                const forecastData = {
                    labels: ['Q1', 'Q2', 'Q3', 'Q4'],
                    values: [125000, 145000, 165000, 185000]
                };
                
                // Create forecast chart
                const ctx = document.getElementById('quarterlyForecastChart').getContext('2d');
                
                if (window.forecastChartInstance) {
                    window.forecastChartInstance.destroy();
                }
                
                window.forecastChartInstance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: forecastData.labels,
                        datasets: [{
                            label: 'Revenue Forecast',
                            data: forecastData.values,
                            backgroundColor: 'rgba(42, 157, 143, 0.2)',
                            borderColor: '#2a9d8f',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return '$' + value.toLocaleString();
                                    }
                                }
                            }
                        }
                    }
                });
                
            } catch (error) {
                console.error('Error loading forecasts data:', error);
            }
        }
        
        // Load analytics data
        async function loadAnalyticsData() {
            try {
                // Sample analytics data
                const performanceData = {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    values: [85, 78, 92, 89, 95, 90]
                };
                
                const conversionData = {
                    labels: ['Website', 'Referral', 'Social Media', 'Email', 'Direct'],
                    values: [25, 30, 15, 20, 10]
                };
                
                // Create performance chart
                const performanceCtx = document.getElementById('performanceMetricsChart').getContext('2d');
                
                if (window.performanceChartInstance) {
                    window.performanceChartInstance.destroy();
                }
                
                window.performanceChartInstance = new Chart(performanceCtx, {
                    type: 'bar',
                    data: {
                        labels: performanceData.labels,
                        datasets: [{
                            label: 'Performance Score',
                            data: performanceData.values,
                            backgroundColor: '#264653',
                            borderColor: '#1a3340',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });
                
                // Create conversion chart
                const conversionCtx = document.getElementById('conversionRatesChart').getContext('2d');
                
                if (window.conversionChartInstance) {
                    window.conversionChartInstance.destroy();
                }
                
                window.conversionChartInstance = new Chart(conversionCtx, {
                    type: 'doughnut',
                    data: {
                        labels: conversionData.labels,
                        datasets: [{
                            data: conversionData.values,
                            backgroundColor: [
                                '#264653',
                                '#2a9d8f',
                                '#e76f51',
                                '#f4a261',
                                '#6c757d'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
                
            } catch (error) {
                console.error('Error loading analytics data:', error);
            }
        }
        
        // Create tasks chart
        function createTasksChart(tasks) {
            const ctx = document.getElementById('tasksOverviewChart').getContext('2d');
            
            // Group tasks by month
            const monthlyData = {};
            tasks.forEach(task => {
                if (task['Due date']) {
                    const month = task['Due date'].substring(0, 7); // YYYY-MM
                    if (!monthlyData[month]) {
                        monthlyData[month] = 0;
                    }
                    monthlyData[month]++;
                }
            });
            
            const labels = Object.keys(monthlyData).sort();
            const data = labels.map(month => monthlyData[month]);
            
            if (window.tasksChartInstance) {
                window.tasksChartInstance.destroy();
            }
            
            window.tasksChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Tasks by Month',
                        data: data,
                        backgroundColor: '#2a9d8f',
                        borderColor: '#23857a',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }
        
        // Create tasks by status chart
        function createTasksByStatusChart(tasks) {
            const ctx = document.getElementById('tasksByStatusChart').getContext('2d');
            
            const statusCounts = {
                'Not Started': 0,
                'In Progress': 0,
                'Complete': 0
            };
            
            tasks.forEach(task => {
                if (statusCounts.hasOwnProperty(task.Status)) {
                    statusCounts[task.Status]++;
                }
            });
            
            if (window.statusChartInstance) {
                window.statusChartInstance.destroy();
            }
            
            window.statusChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Not Started', 'In Progress', 'Complete'],
                    datasets: [{
                        data: [statusCounts['Not Started'], statusCounts['In Progress'], statusCounts['Complete']],
                        backgroundColor: [
                            '#264653',
                            '#f4a261',
                            '#2a9d8f'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }
        
        // Generate SINO
        async function generateSINO() {
            const snapshot = await db.collection('tasks').get();
            let maxNumber = 0;

            snapshot.forEach(doc => {
                const task = doc.data();
                const sino = task.SINO;
                if (sino) {
                    const match = sino.match(/(\d+)$/);
                    if (match) {
                        const num = parseInt(match[1], 10);
                        if (num > maxNumber) {
                            maxNumber = num;
                        }
                    }
                }
            });

            const nextNumber = maxNumber + 1;
            return String(nextNumber).padStart(3, '0');
        }
        
        // Load dropdown options
        async function loadDropdownOptions() {
            try {
                const snapshot = await db.collection('tasks').get();
                
                const companies = new Set();
                const workTypes = new Set();
                const accounts = new Set();
                const assignedBys = new Set();
                
                snapshot.forEach(doc => {
                    const task = doc.data();
                    if (task['Existing Company Name']) companies.add(task['Existing Company Name']);
                    if (task['TYPE OF WORK']) workTypes.add(task['TYPE OF WORK']);
                    if (task['Accounts / Cards']) accounts.add(task['Accounts / Cards']);
                    if (task['Assigned By']) assignedBys.add(task['Assigned By']);
                });
                
                // Update datalists
                const companyDatalist = document.getElementById('companyDatalist');
                companyDatalist.innerHTML = '';
                companies.forEach(company => {
                    const option = document.createElement('option');
                    option.value = company;
                    companyDatalist.appendChild(option);
                });
                
                const workTypeDatalist = document.getElementById('workTypeDatalist');
                workTypeDatalist.innerHTML = '';
                workTypes.forEach(workType => {
                    const option = document.createElement('option');
                    option.value = workType;
                    workTypeDatalist.appendChild(option);
                });
                
                const accountsCardsDatalist = document.getElementById('accountsCardsDatalist');
                accountsCardsDatalist.innerHTML = '';
                accounts.forEach(account => {
                    const option = document.createElement('option');
                    option.value = account;
                    accountsCardsDatalist.appendChild(option);
                });
                
                const assignedByDatalist = document.getElementById('assignedByDatalist');
                assignedByDatalist.innerHTML = '';
                assignedBys.forEach(assignedBy => {
                    const option = document.createElement('option');
                    option.value = assignedBy;
                    assignedByDatalist.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading dropdown options:', error);
            }
        }
        
        // Handle form submission
        submitTaskBtn.addEventListener('click', async (e) => {
            e.preventDefault();
            
            if (!currentUser) {
                showToast('Please log in to create tasks');
                return;
            }
            
            try {
                showLoading();
                
                const formData = new FormData(taskForm);
                const taskData = Object.fromEntries(formData.entries());
                
                // Add timestamp and created by
                taskData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                taskData.CreatedBy = currentUser;
                
                // Save to Firestore
                await db.collection('tasks').add(taskData);
                
                showToast('Task created successfully');
                taskModal.style.display = 'none';
                taskForm.reset();
                
                // Reload current page data
                const activePage = document.querySelector('.page.active').id;
                if (activePage === 'tasks') {
                    loadTasks();
                } else if (activePage === 'dashboard') {
                    loadDashboardData();
                } else if (activePage === 'leads') {
                    loadLeadsData();
                } else if (activePage === 'accounts') {
                    loadAccountsData();
                }
            } catch (error) {
                console.error('Error creating task:', error);
                showToast('Error creating task');
            } finally {
                hideLoading();
            }
        });
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is already logged in
            checkLoginStatus();
            
            // Set up WORK FOR dropdown change handler
            document.getElementById('workFor').addEventListener('change', function(e) {
                const periodInput = document.getElementById('period');
                
                switch(e.target.value) {
                    case 'Yearly':
                        periodInput.placeholder = 'Enter year (e.g., 2023)';
                        break;
                    case 'Monthly':
                        periodInput.placeholder = 'Enter month and year (e.g., Jan 2023)';
                        break;
                    case 'Quarterly':
                        periodInput.placeholder = 'Enter quarter and year (e.g., Q1 2023)';
                        break;
                    case 'Bi-weekly':
                        periodInput.placeholder = 'Enter bi-weekly period (e.g., 1-15 Jan 2023)';
                        break;
                    case 'Weekly':
                        periodInput.placeholder = 'Enter week and year (e.g., Week 5, 2023)';
                        break;
                    case 'Custom':
                        periodInput.placeholder = 'Enter custom period (e.g., Jan-Mar 2023)';
                        break;
                    default:
                        periodInput.placeholder = 'Enter period';
                }
                
                periodInput.required = e.target.value !== '';
            });
            
            // Set initial placeholder for period field
            const workForSelect = document.getElementById('workFor');
            const periodInput = document.getElementById('period');
            
            if (workForSelect.value) {
                workForSelect.dispatchEvent(new Event('change'));
            } else {
                periodInput.placeholder = 'Select WORK FOR first';
                periodInput.disabled = true;
            }
            
            workForSelect.addEventListener('change', function() {
                periodInput.disabled = !this.value;
            });
        });
    </script>
</body>
</html>
