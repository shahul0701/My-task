<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>User Dashboard – Task Manager</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f4f7f9;
      margin: 0;
      padding: 0 20px 40px;
      max-width: 1100px;
      margin-left: auto;
      margin-right: auto;
    }

    header {
      position: relative;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 0;
      border-bottom: 2px solid #16a085;
      font-weight: 600;
      color: #16a085;
      user-select: none;
    }

    .left-label {
      font-size: 1.2rem;
    }

    .center-datetime {
      font-size: 1.2rem;
      font-weight: 600;
    }

    .profile-container {
      position: relative;
      cursor: pointer;
    }

    .profile-name {
      color: #16a085;
      font-weight: 600;
      padding: 8px 12px;
      border-radius: 12px;
      background: #d1f0eb;
      transition: background 0.3s;
    }

    .profile-name:hover {
      background: #b0e4d8;
    }

    .dropdown {
      display: none;
      position: absolute;
      top: 110%;
      right: 0;
      background: white;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-shadow: 0 8px 16px rgba(22, 160, 133, 0.25);
      width: 120px;
      z-index: 10;
    }

    .dropdown.show {
      display: block;
    }

    .dropdown button {
      width: 100%;
      padding: 10px;
      border: none;
      background: none;
      font-weight: 600;
      color: #16a085;
      cursor: pointer;
      border-radius: 8px;
      transition: background 0.2s;
    }

    .dropdown button:hover {
      background: #1abc9c;
      color: white;
    }

    main {
      display: flex;
      gap: 24px;
      margin-top: 20px;
    }

    .sidebar {
      width: 180px;
      background-color: #ffffff;
      border-radius: 15px;
      box-shadow: 0 8px 16px rgba(22, 160, 133, 0.15);
      padding: 20px;
      font-weight: 600;
      color: #16a085;
      user-select: none;
    }

    .sidebar ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .sidebar .menu-item {
      padding: 10px 14px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s, color 0.3s;
    }

    .sidebar .menu-item:hover,
    .sidebar .menu-item.active {
      background-color: #1abc9c;
      color: white;
    }

    /* Attendance menu item specific styles */
    .attendance-menu-item {
      background: #27ae60;
      color: white;
    }

    .attendance-menu-item:hover {
      background: #2ecc71 !important;
    }

    .main-content {
      display: flex;
      gap: 24px;
      flex-grow: 1;
    }

    .left-panel {
      flex: 1;
      background: white;
      border-radius: 15px;
      box-shadow: 0 8px 16px rgba(22, 160, 133, 0.15);
      padding: 20px;
      min-height: 400px;
    }

    .right-panel {
      flex: 1;
      background: white;
      border-radius: 15px;
      box-shadow: 0 8px 16px rgba(22, 160, 133, 0.15);
      padding: 20px;
      min-height: 400px;
      display: flex;
      flex-direction: column;
    }

    .todo-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .todo-header button {
      background: #16a085;
      border: none;
      color: white;
      padding: 6px 14px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.3s;
    }

    .todo-header button:hover {
      background: #1abc9c;
    }

    ul.todo-list {
      list-style: none;
      padding-left: 0;
      margin: 0;
      overflow-y: auto;
      flex-grow: 1;
      max-height: 340px;
    }

    ul.todo-list li {
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      font-size: 1rem;
      padding: 8px;
      background: #f8f9fa;
      border-radius: 8px;
    }

    ul.todo-list li label {
      margin-left: 8px;
      cursor: pointer;
      flex-grow: 1;
      user-select: none;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    ul.todo-list li.completed label {
      text-decoration: line-through;
      color: #999;
    }

    ul.todo-list li.completed {
      opacity: 0.6;
    }

    .add-task-container {
      margin-bottom: 12px;
      display: flex;
      gap: 8px;
    }

    .add-task-container input {
      flex-grow: 1;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1rem;
    }

    .add-task-container button {
      background: #16a085;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 8px 16px;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.3s;
    }

    .add-task-container button:hover {
      background: #1abc9c;
    }

    /* Delete button styles */
    .delete-btn {
      background: #e74c3c;
      color: white;
      border: none;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.8rem;
      margin-left: 8px;
      transition: background 0.3s;
    }

    .delete-btn:hover {
      background: #c0392b;
    }

    /* New styles for left panel pending tasks */
    .pending-tasks-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      font-weight: 600;
      color: #16a085;
    }

    .pending-tasks-list {
      list-style: none;
      padding-left: 0;
      margin: 0;
      overflow-y: auto;
      max-height: 340px;
    }

    .pending-tasks-list li {
      margin-bottom: 12px;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #ffc107;
      display: flex;
      flex-direction: column;
      gap: 4px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .pending-tasks-list li:hover {
      background: #e9ecef;
    }

    .pending-tasks-list li.in-progress {
      border-left-color: #17a2b8;
    }

    .pending-tasks-list li .task-title {
      font-weight: 600;
      color: #333;
      margin: 0;
    }

    .pending-tasks-list li .task-status {
      font-size: 0.9rem;
      color: #666;
    }

    .pending-tasks-list li .next-due {
      font-size: 0.85rem;
      color: #e74c3c;
      font-style: italic;
    }

    .pending-tasks-list li .company {
      font-size: 0.9rem;
      color: #555;
    }

    .no-pending {
      text-align: center;
      color: #999;
      font-style: italic;
      padding: 40px 0;
    }

    /* Error and loading states */
    .error-message {
      color: #e74c3c;
      text-align: center;
      padding: 20px;
      background: #ffeaea;
      border-radius: 8px;
      margin: 10px 0;
    }

    .loading-message {
      color: #7f8c8d;
      text-align: center;
      padding: 20px;
      font-style: italic;
    }

    /* Toast Notification */
    .toast {
      position: fixed;
      top: 80px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      z-index: 10000;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      max-width: 300px;
      transform: translateX(150%);
    }

    .toast.show {
      transform: translateX(0);
    }

    .toast.success {
      background: #27ae60;
    }

    .toast.error {
      background: #e74c3c;
    }

    .toast.warning {
      background: #f39c12;
    }

    .toast.info {
      background: #3498db;
    }

    /* Loading spinner for attendance check */
    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid #f3f3f3;
      border-top: 2px solid #3498db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 8px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .sidebar {
        width: 100%;
      }
      .main-content {
        flex-direction: column;
      }
      .toast {
        right: 10px;
        left: 10px;
        max-width: none;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="left-label">Tasks</div>
    <div class="center-datetime" id="dateTimeDisplay">Loading...</div>
    <div class="profile-container" id="profileContainer" tabindex="0" aria-haspopup="true" aria-expanded="false">
      <div class="profile-name" id="profileName">User</div>
      <div class="dropdown" id="profileDropdown">
        <button id="settingBtn">Setting</button>
        <button id="logoutBtn">Logout</button>
      </div>
    </div>
  </header>

  <main>
    <nav class="sidebar">
      <ul>
        <li class="menu-item active" data-section="tasks">Tasks</li>
        <li class="menu-item" data-section="chart">View in Chart</li>
        <li class="menu-item" data-section="report">Generate Report</li>
        <!-- Attendance Menu Item -->
        <li class="menu-item attendance-menu-item" id="attendanceMenuItem">
          <a href="#" id="attendanceLink" style="color: inherit; text-decoration: none; display: block;">
            <span id="attendanceIcon">⏱️</span>
            <span id="attendanceText">Attendance</span>
            <span id="attendanceLoading" class="loading" style="display: none;"></span>
          </a>
        </li>
      </ul>
    </nav>

    <div class="main-content">
      <section class="left-panel">
        <div class="pending-tasks-header">
          <h2>Pending & In Progress Tasks</h2>
        </div>
        <ul class="pending-tasks-list" id="pendingTasksList">
          <li class="loading-message">Loading pending tasks...</li>
        </ul>
      </section>

      <section class="right-panel">
        <div class="todo-header">
          <button id="prevDayBtn">&lt; Prev</button>
          <div id="todoDateLabel">Day 1</div>
          <button id="nextDayBtn">Next &gt;</button>
        </div>

        <div class="add-task-container">
          <input type="text" id="newTaskInput" placeholder="Add a new task..." />
          <button id="addTaskBtn">Add Task</button>
        </div>

        <ul class="todo-list" id="todoList">
          <li class="loading-message">Loading tasks...</li>
        </ul>
      </section>
    </div>
  </main>

  <!-- Toast Notification -->
  <div id="toast" class="toast"></div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDYhLNuJKj2ucwGimfddTfpTb32Y0c-bXg",
      authDomain: "mytask-96a79.firebaseapp.com",
      databaseURL: "https://mytask-96a79-default-rtdb.firebaseio.com",
      projectId: "mytask-96a79",
      storageBucket: "mytask-96a79.firebasestorage.app",
      messagingSenderId: "963509757773",
      appId: "1:963509757773:web:d9c81a108f5873702eb904",
      measurementId: "G-L9C1LTCZRN"
    };
    
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Get user info from sessionStorage
    const username = sessionStorage.getItem("username");
    const fullName = sessionStorage.getItem("fullName");

    // Redirect to login if no username
    if (!username) {
      window.location.href = "index.html";
    } else {
      document.getElementById("profileName").textContent = fullName || username;
    }

    // Toast notification function
    function showToast(message, type = 'info') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = 'toast';
      toast.classList.add(type, 'show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 4000);
    }

    // Profile dropdown functionality
    const profileContainer = document.getElementById("profileContainer");
    const dropdown = document.getElementById("profileDropdown");

    profileContainer.addEventListener("click", () => {
      const isShown = dropdown.classList.contains("show");
      dropdown.classList.toggle("show", !isShown);
      profileContainer.setAttribute("aria-expanded", !isShown);
    });

    document.addEventListener("click", (e) => {
      if (!profileContainer.contains(e.target)) {
        dropdown.classList.remove("show");
        profileContainer.setAttribute("aria-expanded", false);
      }
    });

    document.getElementById("logoutBtn").addEventListener("click", () => {
      sessionStorage.clear();
      window.location.href = "index.html";
    });

    document.getElementById("settingBtn").addEventListener("click", () => {
      window.location.href = "Change Password.html";
    });

    // Date and time display
    const dateTimeDisplay = document.getElementById("dateTimeDisplay");
    function updateDateTime() {
      const now = new Date();
      const options = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };
      const dateStr = now.toLocaleDateString(undefined, options);
      const timeStr = now.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit' });
      dateTimeDisplay.textContent = `${dateStr} ${timeStr}`;
    }
    updateDateTime();
    setInterval(updateDateTime, 60000);

    // DOM elements
    const todoListEl = document.getElementById("todoList");
    const todoDateLabel = document.getElementById("todoDateLabel");
    const prevDayBtn = document.getElementById("prevDayBtn");
    const nextDayBtn = document.getElementById("nextDayBtn");
    const newTaskInput = document.getElementById("newTaskInput");
    const addTaskBtn = document.getElementById("addTaskBtn");
    const pendingTasksList = document.getElementById("pendingTasksList");

    let currentDate = new Date();
    let currentTasks = [];

    // Utility functions
    function getFormattedDate(date) {
      return date.toISOString().split("T")[0];
    }

    function getReadableDate(date) {
      return date.toLocaleDateString(undefined, {
        year: 'numeric', month: 'short', day: 'numeric'
      });
    }

    // Improved error handling function
    function showError(element, message) {
      element.innerHTML = `<div class="error-message">${message}</div>`;
    }

    function showLoading(element, message = "Loading...") {
      element.innerHTML = `<div class="loading-message">${message}</div>`;
    }

    // Enhanced attendance link click handler with multiple lookup methods
    document.getElementById('attendanceLink').addEventListener('click', async function(e) {
      e.preventDefault();
      
      const attendanceLink = document.getElementById('attendanceLink');
      const attendanceLoading = document.getElementById('attendanceLoading');
      const attendanceIcon = document.getElementById('attendanceIcon');
      const attendanceText = document.getElementById('attendanceText');
      
      // Show loading state
      attendanceLoading.style.display = 'inline-block';
      attendanceIcon.style.display = 'none';
      attendanceText.textContent = 'Checking...';
      attendanceLink.style.pointerEvents = 'none';
      
      try {
        const currentUsername = sessionStorage.getItem("username");
        if (!currentUsername || currentUsername === "Guest") {
          showToast('Please log in to access attendance', 'error');
          resetAttendanceLink();
          return;
        }

        console.log("Looking up user:", currentUsername);

        // Method 1: Try to find user by username first (since we have username in session)
        let userDoc = null;
        let userData = null;

        // Search by username
        const usernameQuery = await db.collection("users")
          .where("username", "==", currentUsername)
          .get();

        if (!usernameQuery.empty) {
          userDoc = usernameQuery.docs[0];
          userData = userDoc.data();
          console.log("User found by username:", userData);
        } else {
          // Method 2: If not found by username, try to get all users and find by partial match
          console.log("User not found by exact username, trying broader search...");
          const allUsersSnapshot = await db.collection("users").get();
          const allUsers = allUsersSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
          
          // Try to find user by partial username match (case insensitive)
          const foundUser = allUsers.find(user => 
            user.username && user.username.toLowerCase().includes(currentUsername.toLowerCase())
          );
          
          if (foundUser) {
            userData = foundUser;
            console.log("User found by partial match:", userData);
          } else {
            // Method 3: Show all available users for debugging
            console.log("All users in database:", allUsers);
            showToast('User account not found. Please contact administrator.', 'error');
            resetAttendanceLink();
            return;
          }
        }

        if (userData) {
          const attendanceEnabled = userData.attendanceEnabled || false;
          
          if (attendanceEnabled) {
            showToast('Redirecting to attendance...', 'success');
            setTimeout(() => {
              window.location.href = "Attendance.html";
            }, 1000);
          } else {
            showToast('Attendance feature is not enabled for your account. Please contact administrator.', 'warning');
            resetAttendanceLink();
          }
        }
      } catch (error) {
        console.error("Error checking attendance setting:", error);
        showToast('Something went wrong. Please try again.', 'error');
        resetAttendanceLink();
      }
    });

    function resetAttendanceLink() {
      const attendanceLoading = document.getElementById('attendanceLoading');
      const attendanceIcon = document.getElementById('attendanceIcon');
      const attendanceText = document.getElementById('attendanceText');
      const attendanceLink = document.getElementById('attendanceLink');
      
      attendanceLoading.style.display = 'none';
      attendanceIcon.style.display = 'inline-block';
      attendanceText.textContent = 'Attendance';
      attendanceLink.style.pointerEvents = 'auto';
    }

    // Check user attendance status on page load and update UI accordingly
    async function checkUserAttendanceStatus() {
      try {
        const currentUsername = sessionStorage.getItem("username");
        if (!currentUsername || currentUsername === "Guest") return;

        const usernameQuery = await db.collection("users")
          .where("username", "==", currentUsername)
          .get();

        if (!usernameQuery.empty) {
          const userData = usernameQuery.docs[0].data();
          const attendanceEnabled = userData.attendanceEnabled || false;
          
          // Update attendance link style based on status
          const attendanceMenuItem = document.getElementById('attendanceMenuItem');
          if (attendanceEnabled) {
            attendanceMenuItem.style.background = '#27ae60';
            attendanceMenuItem.style.opacity = '1';
          } else {
            attendanceMenuItem.style.background = '#95a5a6';
            attendanceMenuItem.style.opacity = '0.7';
          }
        }
      } catch (error) {
        console.error("Error checking user attendance status:", error);
      }
    }

    // Load pending tasks with better error handling
    async function loadPendingTasks() {
      showLoading(pendingTasksList, "Loading pending tasks...");
      
      try {
        console.log("Loading pending tasks for user:", username);
        
        const snapshot = await db.collection('tasks')
          .where('Owner', '==', username)
          .where('Status', 'in', ['Not Started', 'In Progress', 'Pending'])
          .get();

        console.log("Found", snapshot.size, "pending tasks");

        const pendingTasks = [];
        snapshot.forEach(doc => {
          const task = { id: doc.id, ...doc.data() };
          pendingTasks.push(task);
        });

        renderPendingTasks(pendingTasks);
      } catch (error) {
        console.error("Error loading pending tasks:", error);
        showError(pendingTasksList, `Error loading tasks: ${error.message}`);
      }
    }

    function renderPendingTasks(tasks) {
      if (tasks.length === 0) {
        pendingTasksList.innerHTML = '<div class="no-pending">No pending or in-progress tasks found.</div>';
        return;
      }

      pendingTasksList.innerHTML = '';
      tasks.forEach(task => {
        const li = document.createElement('li');
        li.className = task.Status === 'In Progress' ? 'in-progress' : '';
        
        // Use available task fields with fallbacks
        const taskTitle = task['Task'] || task['TYPE OF WORK'] || 'Untitled Task';
        const company = task['Existing Company Name'] || task['Company'] || 'N/A';
        const dueDate = task['Due date'] ? getReadableDate(new Date(task['Due date'])) : 'No due date';
        
        li.innerHTML = `
          <div class="task-title">${taskTitle}</div>
          <div class="company">${company}</div>
          <div class="task-status">Status: ${task.Status}</div>
          <div class="next-due">Due: ${dueDate}</div>
        `;
        
        li.addEventListener('click', () => {
          window.location.href = `User task.html?id=${task.id}`;
        });
        pendingTasksList.appendChild(li);
      });
    }

    // Load daily tasks with better error handling
    async function loadTasks(dateObj) {
      const dateKey = getFormattedDate(dateObj);
      todoDateLabel.textContent = getReadableDate(dateObj);
      showLoading(todoListEl, "Loading tasks...");

      try {
        // Load manual tasks
        let manualTasks = [];
        try {
          const docRef = db.collection("userTasks").doc(username);
          const docSnap = await docRef.get();
          if (docSnap.exists) {
            const data = docSnap.data();
            manualTasks = data?.tasks?.[dateKey] || [];
          }
        } catch (error) {
          console.warn("Could not load manual tasks:", error);
        }

        currentTasks = manualTasks.map(t => ({ ...t, isManual: true }));
        renderTasks(currentTasks);

      } catch (error) {
        console.error("Error loading tasks:", error);
        showError(todoListEl, `Error loading tasks: ${error.message}`);
      }
    }

    function renderTasks(tasks) {
      if (!tasks || tasks.length === 0) {
        todoListEl.innerHTML = "<div class='no-pending'>No tasks for this date. Add a task above!</div>";
        return;
      }

      todoListEl.innerHTML = "";
      tasks.forEach((task, index) => {
        const li = document.createElement("li");
        if (task.completed) li.classList.add("completed");

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = task.completed || false;
        checkbox.id = `task-${index}`;

        const label = document.createElement("label");
        label.htmlFor = checkbox.id;
        label.textContent = task.text;

        const deleteBtn = document.createElement("button");
        deleteBtn.className = "delete-btn";
        deleteBtn.textContent = "🗑️";
        deleteBtn.title = "Delete task";

        li.appendChild(checkbox);
        li.appendChild(label);
        li.appendChild(deleteBtn);
        todoListEl.appendChild(li);
      });
    }

    // Event listeners for task management
    todoListEl.addEventListener('change', (e) => {
      if (e.target.type === 'checkbox') {
        const li = e.target.closest('li');
        const index = Array.from(todoListEl.children).indexOf(li);
        const task = currentTasks[index];
        if (task) {
          task.completed = e.target.checked;
          li.classList.toggle("completed", e.target.checked);
          if (task.isManual) {
            saveTasks(currentDate, currentTasks.filter(t => t.isManual));
          }
        }
      }
    });

    todoListEl.addEventListener('click', (e) => {
      if (e.target.classList.contains('delete-btn')) {
        e.stopPropagation();
        const li = e.target.closest('li');
        const index = Array.from(todoListEl.children).indexOf(li);
        
        if (confirm("Are you sure you want to delete this task?")) {
          currentTasks.splice(index, 1);
          renderTasks(currentTasks);
          saveTasks(currentDate, currentTasks.filter(t => t.isManual));
        }
      }
    });

    // Save tasks to Firestore
    async function saveTasks(dateObj, tasks) {
      const dateKey = getFormattedDate(dateObj);
      try {
        const docRef = db.collection("userTasks").doc(username);
        const docSnap = await docRef.get();
        let allTasks = {};
        if (docSnap.exists) {
          allTasks = docSnap.data().tasks || {};
        }
        allTasks[dateKey] = tasks;
        await docRef.set({ tasks: allTasks }, { merge: true });
      } catch (error) {
        console.error("Error saving tasks:", error);
        alert("Failed to save task. Please try again.");
      }
    }

    // Add new task
    addTaskBtn.addEventListener("click", () => {
      const taskText = newTaskInput.value.trim();
      if (!taskText) {
        alert("Please enter a task description.");
        return;
      }

      currentTasks.push({ 
        text: taskText, 
        completed: false, 
        isManual: true,
        createdAt: new Date().toISOString()
      });
      
      saveTasks(currentDate, currentTasks.filter(t => t.isManual))
        .then(() => {
          renderTasks(currentTasks);
          newTaskInput.value = "";
          newTaskInput.focus();
        })
        .catch((error) => {
          console.error("Error adding task:", error);
          alert("Failed to add task. Please try again.");
        });
    });

    newTaskInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        addTaskBtn.click();
      }
    });

    // Date navigation
    prevDayBtn.addEventListener("click", () => {
      currentDate.setDate(currentDate.getDate() - 1);
      loadTasks(currentDate);
    });

    nextDayBtn.addEventListener("click", () => {
      currentDate.setDate(currentDate.getDate() + 1);
      loadTasks(currentDate);
    });

    // Menu navigation
    document.querySelectorAll(".menu-item").forEach(item => {
      if (item.id !== 'attendanceMenuItem') {
        item.addEventListener("click", () => {
          document.querySelectorAll(".menu-item").forEach(el => el.classList.remove("active"));
          item.classList.add("active");
          const section = item.getAttribute("data-section");
          switch (section) {
            case "tasks":
              window.location.href = "User task.html";
              break;
            case "chart":
              window.location.href = "UserChart.html";
              break;
            case "report":
              window.location.href = "User Generate Report.Html";
              break;
          }
        });
      }
    });

    // Initialize the application
    loadTasks(currentDate);
    loadPendingTasks();
    checkUserAttendanceStatus();
    
    // Auto-refresh every 2 minutes
    setInterval(loadPendingTasks, 120000);
  </script>
</body>
</html>