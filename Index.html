<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskFlow Pro - Smart Task Management</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Navbar */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            color: white;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 24px;
            font-weight: bold;
        }

        .logo i {
            color: #00ff9d;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            margin-left: 30px;
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: #00ff9d;
        }

        .login-btn {
            background: #00ff9d;
            color: #333;
            padding: 10px 25px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s;
            cursor: pointer;
            border: none;
            font-size: 16px;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 157, 0.3);
        }

        /* Hero Section */
        .hero {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 80px 0;
            color: white;
        }

        .hero-content {
            flex: 1;
            max-width: 600px;
        }

        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 20px;
            line-height: 1.2;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .hero p {
            font-size: 1.2rem;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .cta-buttons {
            display: flex;
            gap: 20px;
            margin-top: 40px;
        }

        .btn {
            padding: 15px 30px;
            border-radius: 30px;
            text-decoration: none;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            cursor: pointer;
            border: none;
            font-size: 16px;
        }

        .btn-primary {
            background: #00ff9d;
            color: #333;
        }

        .btn-secondary {
            background: transparent;
            color: white;
            border: 2px solid white;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .hero-image {
            flex: 1;
            text-align: center;
        }

        .hero-image img {
            max-width: 100%;
            filter: drop-shadow(0 20px 30px rgba(0,0,0,0.3));
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        /* Login Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .login-card {
            background: white;
            border-radius: 20px;
            width: 100%;
            max-width: 400px;
            padding: 40px;
            box-shadow: 0 30px 60px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease-out;
            position: relative;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            color: #666;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close-modal:hover {
            color: #333;
        }

        .login-card h2 {
            color: #16a085;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2rem;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 600;
        }

        .input-group input, .input-group select, .input-group textarea {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .input-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .input-group input:focus, .input-group select:focus, .input-group textarea:focus {
            outline: none;
            border-color: #16a085;
            box-shadow: 0 0 0 3px rgba(22, 160, 133, 0.1);
        }

        .login-action-btn {
            width: 100%;
            padding: 15px;
            background: #16a085;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .login-action-btn:hover {
            background: #1abc9c;
            transform: translateY(-2px);
        }

        .forgot-password {
            text-align: right;
            margin-top: 15px;
        }

        .forgot-password a {
            color: #16a085;
            text-decoration: none;
            font-size: 14px;
        }

        .forgot-password a:hover {
            text-decoration: underline;
        }

        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        /* Warning Message */
        .warning-message {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid #ffeaa7;
            display: none;
        }

        .warning-message.show {
            display: block;
        }

        .warning-message i {
            margin-right: 10px;
            color: #f39c12;
        }

        /* Email Preview Modal */
        .email-preview {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid #3498db;
            display: none;
        }

        .email-preview.show {
            display: block;
        }

        .email-header {
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }

        .email-preview h4 {
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .email-preview small {
            color: #7f8c8d;
        }

        .email-body {
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-size: 14px;
            line-height: 1.5;
            max-height: 300px;
            overflow-y: auto;
        }

        /* Features Section */
        .features {
            padding: 80px 0;
            background: white;
            border-radius: 30px 30px 0 0;
            margin-top: 50px;
        }

        .section-title {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 50px;
            color: #333;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
        }

        .feature-card {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            transition: transform 0.3s;
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        }

        .feature-icon {
            font-size: 50px;
            color: #667eea;
            margin-bottom: 20px;
        }

        .feature-card h3 {
            margin-bottom: 15px;
            color: #333;
        }

        /* User Type Selection */
        .user-type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: #f8f9fa;
            padding: 5px;
            border-radius: 10px;
        }

        .user-type-btn {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .user-type-btn.active {
            background: #16a085;
            color: white;
            box-shadow: 0 4px 15px rgba(22, 160, 133, 0.3);
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 30px;
            color: white;
            opacity: 0.8;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .hero {
                flex-direction: column;
                text-align: center;
            }
            
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .nav-links {
                display: none;
            }
            
            .cta-buttons {
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .login-card {
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Navbar -->
        <nav class="navbar">
            <div class="logo">
                <i class="fas fa-tasks"></i>
                <span>TaskFlow Pro</span>
            </div>
            <div class="nav-links">
                <a href="#features">Features</a>
                <a href="#about">About</a>
                <a href="#contact">Contact</a>
                <button class="login-btn" id="openLoginModal">
                    <i class="fas fa-sign-in-alt"></i>
                    Login
                </button>
            </div>
        </nav>

        <!-- Hero Section -->
        <section class="hero">
            <div class="hero-content">
                <h1>Smart Task Management Made Simple</h1>
                <p>Organize, track, and collaborate on tasks with our intuitive Kanban board, secure data storage, and attendance tracking system. Perfect for individuals and teams.</p>
                
                <div class="cta-buttons">
                    <button class="btn btn-primary" id="getStartedBtn">
                        <i class="fas fa-rocket"></i>
                        Get Started
                    </button>
                    <a href="#features" class="btn btn-secondary">
                        <i class="fas fa-play-circle"></i>
                        Watch Demo
                    </a>
                </div>
            </div>
            
            <div class="hero-image">
                <img src="https://cdn-icons-png.flaticon.com/512/3067/3067256.png" alt="Task Management Illustration">
            </div>
        </section>

        <!-- Features Section -->
        <section class="features" id="features">
            <h2 class="section-title">Why Choose TaskFlow Pro?</h2>
            
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h3>Secure Data Storage</h3>
                    <p>Bank-level encryption for your sensitive task data and documents</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-columns"></i>
                    </div>
                    <h3>Kanban Board View</h3>
                    <p>Visual task management with drag-and-drop functionality</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-user-clock"></i>
                    </div>
                    <h3>Attendance Tracker</h3>
                    <p>Monitor team attendance and productivity in real-time</p>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <h3>Team Collaboration</h3>
                    <p>Seamless collaboration for individuals and companies</p>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer>
            <p>&copy; 2024 TaskFlow Pro. Created by Shahul. All rights reserved.</p>
            <p style="margin-top: 10px; font-size: 0.9em;">
                <i class="fas fa-lock"></i> Your data is safe with us
            </p>
        </footer>
    </div>

    <!-- Login Modal -->
    <div class="modal-overlay" id="loginModal">
        <div class="login-card">
            <button class="close-modal" id="closeModal">&times;</button>
            
            <h2>Login to TaskFlow</h2>
            
            <!-- Warning Message -->
            <div class="warning-message" id="warningMessage">
                <i class="fas fa-exclamation-triangle"></i>
                <span id="warningText">Your registration request has been sent to the administrator. The creator will approve your request. Please wait for approval.</span>
            </div>

            <!-- Email Preview -->
            <div class="email-preview" id="emailPreview">
                <div class="email-header">
                    <h4>ðŸ“§ Email Draft (Would be sent to: testtocreateapp@gmail.com)</h4>
                    <small>Subject: New User Registration Request - TaskFlow Pro</small>
                </div>
                <div class="email-body" id="emailBody">
                    <!-- Email content will be inserted here -->
                </div>
            </div>

            <!-- User Type Selection -->
            <div class="user-type-selector">
                <button class="user-type-btn active" data-type="existing">
                    <i class="fas fa-user"></i>
                    Existing User
                </button>
                <button class="user-type-btn" data-type="new">
                    <i class="fas fa-user-plus"></i>
                    New User
                </button>
            </div>

            <!-- Error Message -->
            <div class="error-message" id="errorMessage">
                <i class="fas fa-exclamation-circle"></i>
                <span id="errorText"></span>
            </div>

            <!-- Existing User Login Form -->
            <div id="existingUserForm">
                <div class="input-group">
                    <label for="loginUsername">Username</label>
                    <input type="text" id="loginUsername" placeholder="Enter your username">
                </div>
                
                <div class="input-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter your password">
                </div>
                
                <button class="login-action-btn" onclick="tryLogin()">
                    <i class="fas fa-sign-in-alt"></i>
                    Login
                </button>
                
                <div class="forgot-password">
                    <a href="#" onclick="showForgotPassword()">Forgot Password?</a>
                </div>
            </div>

            <!-- New User Registration Form (Initially Hidden) -->
            <div id="newUserForm" style="display: none;">
                <div class="input-group">
                    <label for="userType">Account Type</label>
                    <select id="userType" class="user-type-select" onchange="toggleUserFields()">
                        <option value="individual">Individual</option>
                        <option value="company">Company</option>
                    </select>
                </div>

                <!-- Individual Fields -->
                <div id="individualFields">
                    <div class="input-group">
                        <label for="fullName">Full Name *</label>
                        <input type="text" id="fullName" placeholder="Enter your full name">
                    </div>
                    
                    <div class="input-group">
                        <label for="email">Email Address *</label>
                        <input type="email" id="email" placeholder="Enter your email">
                    </div>
                    
                    <div class="input-group">
                        <label for="phone">Phone Number</label>
                        <input type="tel" id="phone" placeholder="Enter your phone number">
                    </div>
                    
                    <div class="input-group">
                        <label for="dob">Date of Birth</label>
                        <input type="date" id="dob">
                    </div>
                    
                    <div class="input-group">
                        <label for="purpose">Purpose of Use</label>
                        <textarea id="purpose" placeholder="Describe how you plan to use the app" rows="3"></textarea>
                    </div>
                </div>

                <!-- Company Fields -->
                <div id="companyFields" style="display: none;">
                    <div class="input-group">
                        <label for="companyEmail">Company Email *</label>
                        <input type="email" id="companyEmail" placeholder="Enter company email">
                    </div>
                    
                    <div class="input-group">
                        <label for="adminName">Admin Name *</label>
                        <input type="text" id="adminName" placeholder="Enter admin name">
                    </div>
                    
                    <div class="input-group">
                        <label for="companyPhone">Phone Number</label>
                        <input type="tel" id="companyPhone" placeholder="Enter company phone">
                    </div>
                    
                    <div class="input-group">
                        <label for="businessName">Business Name *</label>
                        <input type="text" id="businessName" placeholder="Enter business name">
                    </div>
                    
                    <div class="input-group">
                        <label for="address">Business Address</label>
                        <textarea id="address" placeholder="Enter full business address" rows="3"></textarea>
                    </div>
                </div>

                <div class="input-group">
                    <label for="newUsername">Choose Username *</label>
                    <input type="text" id="newUsername" placeholder="Choose a username">
                </div>
                
                <div class="input-group">
                    <label for="newPassword">Choose Password *</label>
                    <input type="password" id="newPassword" placeholder="Choose a password (min 6 chars)">
                </div>
                
                <button class="login-action-btn" onclick="registerNewUser()">
                    <i class="fas fa-user-plus"></i>
                    Create Account
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDYhLNuJKj2ucwGimfddTfpTb32Y0c-bXg",
            authDomain: "mytask-96a79.firebaseapp.com",
            databaseURL: "https://mytask-96a79-default-rtdb.firebaseio.com",
            projectId: "mytask-96a79",
            storageBucket: "mytask-96a79.firebasestorage.app",
            messagingSenderId: "963509757773",
            appId: "1:963509757773:web:d9c81a108f5873702eb904",
            measurementId: "G-L9C1LTCZRN"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // DOM Elements
        const loginModal = document.getElementById('loginModal');
        const openLoginModalBtn = document.getElementById('openLoginModal');
        const closeModalBtn = document.getElementById('closeModal');
        const getStartedBtn = document.getElementById('getStartedBtn');
        const userTypeBtns = document.querySelectorAll('.user-type-btn');
        const existingUserForm = document.getElementById('existingUserForm');
        const newUserForm = document.getElementById('newUserForm');
        const errorMessage = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');
        const warningMessage = document.getElementById('warningMessage');
        const warningText = document.getElementById('warningText');
        const emailPreview = document.getElementById('emailPreview');
        const emailBody = document.getElementById('emailBody');

        // Check if coming from users.html
        function checkIfFromUsersPage() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('source') === 'users';
        }

        const isFromUsersPage = checkIfFromUsersPage();

        // Modal Controls
        openLoginModalBtn.addEventListener('click', () => {
            loginModal.classList.add('active');
            showExistingUserForm();
        });

        closeModalBtn.addEventListener('click', () => {
            loginModal.classList.remove('active');
            clearForms();
        });

        getStartedBtn.addEventListener('click', () => {
            loginModal.classList.add('active');
            showNewUserForm();
        });

        // Close modal when clicking outside
        loginModal.addEventListener('click', (e) => {
            if (e.target === loginModal) {
                loginModal.classList.remove('active');
                clearForms();
            }
        });

        // User Type Switching
        userTypeBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                userTypeBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                if (btn.dataset.type === 'existing') {
                    showExistingUserForm();
                } else {
                    showNewUserForm();
                }
            });
        });

        function showExistingUserForm() {
            existingUserForm.style.display = 'block';
            newUserForm.style.display = 'none';
            clearError();
            hideWarning();
            hideEmailPreview();
        }

        function showNewUserForm() {
            existingUserForm.style.display = 'none';
            newUserForm.style.display = 'block';
            clearError();
            hideWarning();
            hideEmailPreview();
        }

        function toggleUserFields() {
            const userType = document.getElementById('userType').value;
            const individualFields = document.getElementById('individualFields');
            const companyFields = document.getElementById('companyFields');
            
            if (userType === 'individual') {
                individualFields.style.display = 'block';
                companyFields.style.display = 'none';
            } else {
                individualFields.style.display = 'none';
                companyFields.style.display = 'block';
            }
        }

        function showError(message) {
            errorText.textContent = message;
            errorMessage.classList.add('show');
            hideWarning();
            hideEmailPreview();
        }

        function clearError() {
            errorMessage.classList.remove('show');
        }

        function showWarning(message) {
            warningText.textContent = message;
            warningMessage.classList.add('show');
            clearError();
        }

        function hideWarning() {
            warningMessage.classList.remove('show');
        }

        function showEmailPreview(emailContent) {
            emailBody.textContent = emailContent;
            emailPreview.classList.add('show');
        }

        function hideEmailPreview() {
            emailPreview.classList.remove('show');
        }

        function clearForms() {
            // Clear all input fields
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
            document.getElementById('fullName').value = '';
            document.getElementById('email').value = '';
            document.getElementById('phone').value = '';
            document.getElementById('dob').value = '';
            document.getElementById('purpose').value = '';
            document.getElementById('companyEmail').value = '';
            document.getElementById('adminName').value = '';
            document.getElementById('companyPhone').value = '';
            document.getElementById('businessName').value = '';
            document.getElementById('address').value = '';
            document.getElementById('newUsername').value = '';
            document.getElementById('newPassword').value = '';
            
            // Reset to default state
            showExistingUserForm();
            userTypeBtns.forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.type === 'existing') {
                    btn.classList.add('active');
                }
            });
            clearError();
            hideWarning();
            hideEmailPreview();
        }

        // Generate email draft content
        function generateEmailDraft(userData) {
            const timestamp = new Date().toLocaleString();
            const emailContent = `To: testtocreateapp@gmail.com
From: TaskFlow Pro System <noreply@taskflowpro.com>
Subject: New User Registration Request - TaskFlow Pro
Date: ${timestamp}

Dear Administrator,

A new user has registered on TaskFlow Pro and requires your approval.

REGISTRATION DETAILS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Registration Source: ${isFromUsersPage ? 'users.html (Direct Registration)' : 'Main Landing Page'}
Timestamp: ${timestamp}

USER INFORMATION:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Username: ${userData.username}
Account Type: ${userData.userType === 'individual' ? 'Individual' : 'Company'}
User Role: ${userData.role}

${userData.userType === 'individual' ? `
INDIVIDUAL DETAILS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Full Name: ${userData.fullName || 'Not provided'}
Email: ${userData.email || 'Not provided'}
Phone: ${userData.phone || 'Not provided'}
Date of Birth: ${userData.dob || 'Not provided'}
Purpose: ${userData.purpose || 'Not provided'}
` : `
COMPANY DETAILS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Company Email: ${userData.email || 'Not provided'}
Admin Name: ${userData.adminName || 'Not provided'}
Business Name: ${userData.businessName || 'Not provided'}
Phone: ${userData.phone || 'Not provided'}
Address: ${userData.address || 'Not provided'}
`}

ACCOUNT STATUS: PENDING APPROVAL

ACTION REQUIRED:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Review the user information above
2. Check if all details are valid
3. Approve or reject the registration
4. Update user status in Firebase Firestore

APPROVAL STEPS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Go to Firebase Console: https://console.firebase.google.com/
2. Navigate to Firestore Database
3. Find user with username: ${userData.username}
4. Update 'status' field to 'approved'
5. Add 'approvedAt' timestamp: ${new Date().toISOString()}

REJECTION STEPS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Update 'status' field to 'rejected'
2. Add 'rejectionReason' field with reason
3. Add 'rejectedAt' timestamp

This is an automated notification from TaskFlow Pro System.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TaskFlow Pro Administration Panel
Â© 2024 TaskFlow Pro. All rights reserved.`;

            return emailContent;
        }

        // Login Function
        function tryLogin() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value.trim();
            
            if (!username || !password) {
                showError("Please enter both username and password");
                return;
            }
            
            // Query Firestore for user
            db.collection("users")
                .where("username", "==", username)
                .where("password", "==", password)
                .get()
                .then(querySnapshot => {
                    if (querySnapshot.empty) {
                        showError("Invalid username or password");
                        return;
                    }
                    
                    const userDoc = querySnapshot.docs[0];
                    const userData = userDoc.data();
                    
                    // Check if account is approved
                    if (userData.status === "pending_approval") {
                        showError("Your account is pending approval. Please wait for administrator approval.");
                        return;
                    }
                    
                    // Save user data to sessionStorage
                    sessionStorage.setItem("username", userData.username);
                    if (userData.fullName) {
                        sessionStorage.setItem("fullName", userData.fullName);
                    }
                    
                    // Get role and redirect
                    const role = userData.role ? userData.role.trim().toLowerCase() : "";
                    
                    // Close modal
                    loginModal.classList.remove('active');
                    clearForms();
                    
                    // Redirect based on role
                    if (role === "admin") {
                        window.location.href = "Home.html";
                    } else if (role === "sub admin") {
                        window.location.href = "Sub Admin Dashboard.html";
                    } else if (role === "user") {
                        window.location.href = "UserDashboard.html";
                    } else {
                        alert("User role not recognized: " + userData.role);
                    }
                })
                .catch(error => {
                    console.error("Login error:", error);
                    showError("An error occurred. Please try again.");
                });
        }

        // New User Registration
        async function registerNewUser() {
            const userType = document.getElementById('userType').value;
            const username = document.getElementById('newUsername').value.trim();
            const password = document.getElementById('newPassword').value.trim();
            
            if (!username || !password) {
                showError("Please choose a username and password");
                return;
            }
            
            if (password.length < 6) {
                showError("Password must be at least 6 characters long");
                return;
            }
            
            let userData = {
                username: username,
                password: password,
                status: "active",
                createdAt: new Date().toISOString(),
                registrationSource: isFromUsersPage ? "users.html" : "main_page"
            };
            
            if (userType === 'individual') {
                const fullName = document.getElementById('fullName').value.trim();
                const email = document.getElementById('email').value.trim();
                const phone = document.getElementById('phone').value.trim();
                const dob = document.getElementById('dob').value;
                const purpose = document.getElementById('purpose').value.trim();
                
                if (!fullName || !email) {
                    showError("Please fill in all required fields (*)");
                    return;
                }
                
                userData.fullName = fullName;
                userData.email = email;
                userData.phone = phone;
                userData.dob = dob;
                userData.purpose = purpose;
                userData.userType = 'individual';
                userData.role = 'user';
            } else {
                const companyEmail = document.getElementById('companyEmail').value.trim();
                const adminName = document.getElementById('adminName').value.trim();
                const companyPhone = document.getElementById('companyPhone').value.trim();
                const businessName = document.getElementById('businessName').value.trim();
                const address = document.getElementById('address').value.trim();
                
                if (!companyEmail || !adminName || !businessName) {
                    showError("Please fill in all required fields (*)");
                    return;
                }
                
                userData.email = companyEmail;
                userData.adminName = adminName;
                userData.phone = companyPhone;
                userData.businessName = businessName;
                userData.address = address;
                userData.userType = 'company';
                userData.role = 'admin';
            }
            
            // Check if username already exists
            db.collection("users")
                .where("username", "==", username)
                .get()
                .then(async querySnapshot => {
                    if (!querySnapshot.empty) {
                        showError("Username already exists. Please choose another.");
                        return;
                    }
                    
                    // If registration is from main page (not users.html)
                    if (!isFromUsersPage) {
                        // Set status to pending approval
                        userData.status = "pending_approval";
                        
                        // Generate and show email draft
                        const emailContent = generateEmailDraft(userData);
                        showEmailPreview(emailContent);
                        
                        // Show warning message
                        showWarning("âš ï¸ IMPORTANT: This is a registration from the main landing page. The creator will need to approve your request. An email has been drafted for the administrator (testtocreateapp@gmail.com). In a real system, this email would be automatically sent.");
                        
                        // Save user to Firestore with pending status
                        db.collection("users").add(userData)
                            .then(() => {
                                console.log("Registration request saved with pending status");
                                
                                // Show detailed instructions
                                setTimeout(() => {
                                    alert(`REGISTRATION REQUEST SUBMITTED

Your registration has been saved with PENDING status.

What happens next:
1. An email draft has been prepared for the administrator
2. The administrator will review your request
3. Once approved, your account status will be updated to "approved"
4. You will be able to login after approval

To test login immediately:
1. Open users.html?source=users for direct registration
2. Or ask admin to approve your account in Firebase

Your username: ${username}
Status: Pending Approval`);
                                }, 500);
                            })
                            .catch(error => {
                                console.error("Registration error:", error);
                                showError("Failed to save registration. Please try again.");
                            });
                    } else {
                        // If from users.html, register normally with active status
                        userData.status = "active";
                        
                        // Add user to Firestore
                        db.collection("users").add(userData)
                            .then(() => {
                                alert("âœ… Account created successfully! You can now login.");
                                showExistingUserForm();
                                userTypeBtns.forEach(btn => {
                                    btn.classList.remove('active');
                                    if (btn.dataset.type === 'existing') {
                                        btn.classList.add('active');
                                    }
                                });
                            })
                            .catch(error => {
                                console.error("Registration error:", error);
                                showError("Failed to create account. Please try again.");
                            });
                    }
                })
                .catch(error => {
                    console.error("Username check error:", error);
                    showError("An error occurred. Please try again.");
                });
        }

        // Forgot Password
        function showForgotPassword() {
            const email = prompt("Please enter your email address to reset password:");
            if (email) {
                alert("Password reset link has been sent to " + email);
            }
        }

        // Enter key support
        document.getElementById('loginPassword').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') tryLogin();
        });

        document.getElementById('loginUsername').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') tryLogin();
        });

        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Check if user is already logged in
        document.addEventListener('DOMContentLoaded', () => {
            const sessionUser = sessionStorage.getItem("username");
            if (sessionUser) {
                console.log("âœ… User is already logged in:", sessionUser);
                openLoginModalBtn.innerHTML = '<i class="fas fa-user"></i> ' + sessionUser;
                openLoginModalBtn.onclick = () => {
                    if (confirm("Do you want to logout?")) {
                        sessionStorage.clear();
                        window.location.reload();
                    }
                };
            }
        });
    </script>
</body>
</html>
